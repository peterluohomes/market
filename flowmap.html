<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Freehold Property 12-Month Listing Flow Analysis</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f3f4f6;
      padding: 24px;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      color: #1f2937;
      font-size: 28px;
      margin-bottom: 8px;
    }
    .controls {
      text-align: center;
      margin-bottom: 24px;
    }
    select {
      padding: 8px 16px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
    }
    .subtitle {
      text-align: center;
      color: #6b7280;
      margin-bottom: 24px;
      font-size: 16px;
    }
    .chart-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      padding: 24px;
      margin-bottom: 24px;
    }
    .canvas-wrapper {
      position: relative;
      height: 500px;
      width: 100%;
    }
    .legend-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      padding: 20px;
    }
    .legend-container h3 {
      color: #1f2937;
      margin-bottom: 16px;
      font-size: 18px;
    }
    .legend-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }
    .legend-box {
      padding: 16px;
      border-radius: 8px;
    }
    .legend-box.left { background: #eff6ff; }
    .legend-box.right { background: #faf5ff; }
    .legend-box h4 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #374151;
    }
    .legend-item {
      font-size: 13px;
      color: #4b5563;
      margin: 4px 0;
    }
    .legend-item span { font-weight: 600; }
    .color-blue  { color: #3B82F6; }
    .color-green { color: #22C55E; }
    .color-purple { color: #9333EA; }
    .color-brick  { color: #B91C1C; }
    .color-rose   { color: #EC4899; }
    .color-gold   { color: #EAB308; }
  </style>
</head>
<body>
  <h1>Freehold Property 12-Month Listing Flow Analysis</h1>

  <div class="controls">
    <select id="periodSelect">
      <option value="last" selected>Last 12 Months</option>
      <option value="prior">Prior 12 Months</option>
      <option value="twoyears">2 Years Prior</option>
    </select>
  </div>

  <p class="subtitle" id="subtitle">Feb 2025 – Jan 2026</p>
  
  <div class="chart-container">
    <div class="canvas-wrapper">
      <canvas id="listingFlowChart"></canvas>
    </div>
  </div>

  <div class="legend-container">
    <h3>How to Read This Chart</h3>
    <div class="legend-grid">
      <div class="legend-box left">
        <h4>Left Bar (Beginning of Month)</h4>
        <p class="legend-item">• <span class="color-blue">Blue</span>: Active listings at start</p>
        <p class="legend-item">• <span class="color-green">Green</span>: New listings added</p>
      </div>
      <div class="legend-box right">
        <h4>Right Bar (End of Month)</h4>
        <p class="legend-item">• <span class="color-blue">Blue</span>: Active listings remaining</p>
        <p class="legend-item">• <span class="color-purple">Purple</span>: Terminated</p>
        <p class="legend-item">• <span class="color-brick">Brick Red</span>: Expired</p>
        <p class="legend-item">• <span class="color-rose">Rose</span>: Suspended</p>
        <p class="legend-item">• <span class="color-gold">Gold</span>: Sold</p>
      </div>
    </div>
  </div>

  <script>
    // Data in sheet row order (newest → oldest)
    const fullData = [
  { month:"Jan", begin:10595, new:6597, susp:415, exp:1329, term:2872, trans:2085, end:10491 },
  { month:"Dec", begin:15950, new:3289, susp:678, exp:2548, term:2982, trans:2496, end:10535 },
  { month:"Nov", begin:18990, new:7441, susp:654, exp:1457, term:4779, trans:3591, end:15950 },
  { month:"Oct", begin:20381, new:11312, susp:567, exp:1498, term:6164, trans:4474, end:18990 },
  { month:"Sep", begin:19179, new:13928, susp:583, exp:1586, term:6344, trans:4213, end:20381 },
  { month:"Aug", begin:21012, new:9889, susp:592, exp:1525, term:5791, trans:3814, end:19179 },
  { month:"Jul", begin:21707, new:12590, susp:662, exp:1294, term:6915, trans:4414, end:21012 },
  { month:"Jun", begin:20844, new:14463, susp:615, exp:1103, term:7229, trans:4653, end:21707 },
  { month:"May", begin:17879, new:15729, susp:538, exp:853, term:6615, trans:4758, end:20844 },
  { month:"Apr", begin:15201, new:12936, susp:458, exp:726, term:5000, trans:4074, end:17879 },
  { month:"Mar", begin:12263, new:11573, susp:355, exp:646, term:4155, trans:3479, end:15201 },
  { month:"Feb", begin:10375, new:8308, susp:253, exp:629, term:2650, trans:2888, end:12263 },
  { month:"Jan", begin:9118, new:7741, susp:266, exp:928, term:2683, trans:2607, end:10375 },
  { month:"Dec", begin:13402, new:3221, susp:489, exp:1812, term:2500, trans:2704, end:9118 },
  { month:"Nov", begin:15904, new:7488, susp:557, exp:1208, term:4061, trans:4164, end:13402 },
  { month:"Oct", begin:16809, new:10510, susp:526, exp:1144, term:4871, trans:4874, end:15904 },
  { month:"Sep", begin:14922, new:12643, susp:504, exp:1260, term:5054, trans:3938, end:16809 },
  { month:"Aug", begin:15895, new:8674, susp:547, exp:1164, term:4375, trans:3561, end:14922 },
  { month:"Jul", begin:15615, new:10945, susp:604, exp:809, term:5356, trans:3896, end:15895 },
  { month:"Jun", begin:14214, new:12429, susp:498, exp:644, term:5192, trans:4694, end:15615 },
  { month:"May", begin:11619, new:12879, susp:401, exp:458, term:4380, trans:5045, end:14214 },
  { month:"Apr", begin:9364, new:11474, susp:344, exp:416, term:3504, trans:4955, end:11619 },
  { month:"Mar", begin:8049, new:9057, susp:305, exp:403, term:2329, trans:4705, end:9364 },
  { month:"Feb", begin:7012, new:7489, susp:232, exp:486, term:1726, trans:4008, end:8049 },
  { month:"Jan", begin:7655, new:5192, susp:306, exp:816, term:1851, trans:2862, end:7012 },
  { month:"Dec", begin:11754, new:2439, susp:503, exp:1444, term:2173, trans:2418, end:7655 },
  { month:"Nov", begin:13425, new:7353, susp:626, exp:936, term:4295, trans:3167, end:11754 },
  { month:"Oct", begin:12976, new:10187, susp:571, exp:811, term:4968, trans:3388, end:13425 },
  { month:"Sep", begin:10898, new:11461, susp:500, exp:772, term:4620, trans:3491, end:12976 },
  { month:"Aug", begin:10789, new:8638, susp:515, exp:622, term:3694, trans:3698, end:10898 },
  { month:"Jul", begin:10112, new:9602, susp:424, exp:535, term:3903, trans:4063, end:10789 },
  { month:"Jun", begin:8248, new:11481, susp:349, exp:427, term:3489, trans:5352, end:10112 },
  { month:"May", begin:6723, new:11161, susp:277, exp:305, term:2590, trans:6464, end:8248 },
  { month:"Apr", begin:6379, new:8076, susp:230, exp:281, term:1653, trans:5568, end:6723 },
  { month:"Mar", begin:5733, new:7644, susp:220, exp:333, term:1661, trans:4784, end:6379 },
  { month:"Feb", begin:5516, new:5464, susp:185, exp:368, term:1288, trans:3406, end:5733 },
  { month:"Jan", begin:5128, new:4850, susp:231, exp:578, term:1394, trans:2259, end:5516 }
];

    // 12-month periods — indices point to fullData array (0 = newest)
    const periods = {
  last: {
    indices: [11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
    title: "Feb 2025 – Jan 2026"
  },
  prior: {
    indices: [23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12],
    title: "Feb 2024 – Jan 2025"
  },
  twoyears: {
    indices: [35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25, 24],
    title: "Feb 2023 – Jan 2024"
  }
};

    let currentPeriod = 'last';
    let rawData = periods[currentPeriod].indices.map(i => fullData[i]);
    let myChart;

    document.getElementById('subtitle').textContent = periods[currentPeriod].title;

    const barSpacingPlugin = {
      id: 'barSpacing',
      afterUpdate(chart) {
        const meta = chart.getDatasetMeta(0);
        if (!meta.data?.length) return;
        
        const withinMonthGap = 2;
        const betweenMonthGap = 4;
        
        meta.data.forEach((bar, index) => {
          const monthIndex = Math.floor(index / 2);
          const isSecondBar = index % 2 === 1;
          let offset = monthIndex * betweenMonthGap;
          if (isSecondBar) offset += withinMonthGap;
          
          chart.data.datasets.forEach((_, dsIndex) => {
            const dsMeta = chart.getDatasetMeta(dsIndex);
            if (dsMeta.data?.[index]) {
              dsMeta.data[index].x += offset;
            }
          });
        });
      }
    };

    const ctx = document.getElementById('listingFlowChart').getContext('2d');

    function createChart() {
      const labels = rawData.flatMap(d => [d.month, '']);
      const activeData    = rawData.flatMap(d => [d.begin, d.end]);
      const newData       = rawData.flatMap(d => [d.new, 0]);
      const terminatedData = rawData.flatMap(d => [0, d.term]);
      const expiredData   = rawData.flatMap(d => [0, d.exp]);
      const suspendedData = rawData.flatMap(d => [0, d.susp]);
      const soldData      = rawData.flatMap(d => [0, d.trans]);

      if (myChart) myChart.destroy();

      myChart = new Chart(ctx, {
        type: 'bar',
        plugins: [barSpacingPlugin],
        data: {
          labels,
          datasets: [
            { label: 'Active Listings', data: activeData,    backgroundColor: '#3B82F6', barPercentage:1.0, categoryPercentage:0.88 },
            { label: 'New Listings',     data: newData,      backgroundColor: '#22C55E', barPercentage:1.0, categoryPercentage:0.88 },
            { label: 'Terminated',       data: terminatedData, backgroundColor: '#9333EA', barPercentage:1.0, categoryPercentage:0.88 },
            { label: 'Expired',          data: expiredData,   backgroundColor: '#B91C1C', barPercentage:1.0, categoryPercentage:0.88 },
            { label: 'Suspended',        data: suspendedData, backgroundColor: '#EC4899', barPercentage:1.0, categoryPercentage:0.88 },
            { label: 'Sold',             data: soldData,      backgroundColor: '#EAB308', barPercentage:1.0, categoryPercentage:0.88 }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: { position: 'bottom', labels: { padding:20, usePointStyle:true, font:{size:12} } },
            tooltip: {
              callbacks: {
                title: ctx => rawData[Math.floor(ctx[0].dataIndex / 2)].month,
                label: ctx => {
                  if (ctx.raw === 0) return null;
                  const isBegin = ctx.dataIndex % 2 === 0;
                  const label = ctx.dataset.label;
                  if (label === 'Active Listings') {
                    return isBegin
                      ? `Active Listings at Beginning: ${ctx.raw.toLocaleString()}`
                      : `Active Listings at End: ${ctx.raw.toLocaleString()}`;
                  }
                  return `${label}: ${ctx.raw.toLocaleString()}`;
                },
                filter: ctx => ctx.raw !== 0
              }
            }
          },
          scales: {
            x: { stacked: true, grid: {display:false}, ticks: {font:{size:11}} },
            y: {
              stacked: true,
              beginAtZero: true,
              grid: {color:'#e5e7eb'},
              ticks: {
                callback: v => (v/1000).toFixed(0)+'K',
                font: {size:11}
              },
              title: {
                display: true,
                text: 'Number of Listings',
                font: {size:14, weight:'bold'},
                color: '#374151'
              }
            }
          }
        }
      });
    }

    createChart();

    document.getElementById('periodSelect').addEventListener('change', function() {
      currentPeriod = this.value;
      rawData = periods[currentPeriod].indices.map(i => fullData[i]);
      document.getElementById('subtitle').textContent = periods[currentPeriod].title;
      createChart();
    });
  </script>
</body>
</html>